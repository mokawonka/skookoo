
<%= form_with(model: user, url: [user, :update_profile], local: false, html: {id: "avatarform"}) do |form| %>

    <div class="field">

        <div class="avatar-upload">

            <div class="avatar-edit">
                <%= form.file_field :avatar, direct_upload: true, id:'user_avatar'%>
                <%= form.label :avatar, :'o', style:"color:transparent" %>
            </div>

            <div class="avatar-preview">

                <% if @user.avatar.attached? %>
                    <div id="imagePreview" style="background-image: url(<%=polymorphic_url(@user.avatar.variant(resize_to_limit:[200, 200]))%>);"> </div>
                <% else %>
                    <div id="imagePreview" style="background-image: url('/assets/default-avatar.svg');"> </div>
                <% end %>
            </div>
            
        </div>

    </div>

    <div class="actions">
        <%= form.submit '', class: 'd-none', id: "changeavatar"%>
    </div>

<% end %>


<script>

function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('#imagePreview').css('background-image', 'url(' + e.target.result + ')');
            $('#imagePreview').hide();
            $('#imagePreview').fadeIn(650);
        }
        reader.readAsDataURL(input.files[0]);
    }
}

$("#user_avatar").change(function() {
    readURL(this);
});

</script>